 <{extends file="<{$tempdir}>/public/wxsite.html"}>  
<{block name=extendcss}> 
<link rel="stylesheet"  href="<{$siteurl}>/templates/<{$tempdir}>/public/wxsite/css/mycss.css">   
<link rel="stylesheet"  href="<{$siteurl}>/templates/<{$tempdir}>/public/wxsite/css/order.css">  
<style type="text/css">
	.balchapayma ul .balchapaymaL {
		background-color: inherit;
	}
	
</style>
<{/block}>
 <{block name=extendjs}> 
  <{if empty($order)}>
  <script>
		$(function(){  
		       error($('#supplierlist'),'未获取到订单'); 
			  
		});
  </script>
  <{/if}>
<{/block}>
<{block name=sitetitle}><{$sitename}><{/block}>
<{block name=hearnav}>

<div class="toptitCon">
 <div class="toptitBox">
  <div class="toptitL"><i></i></div>
  <div class="toptitC"><h3><{if $order['paytype'] == 1 && $order['paystatus'] == 0}>订单支付<{else}>提交成功<{/if}></h3></div>
 </div>
</div>




<{/block}>

<{block name=myScrolljs}>
<script> 
 
 $(function(){
	   <{if ($order['paytype'] == 1 && $order['paystatus'] == 1) || $order['paytype'] == 0 }>
	
		var url = '<{ofunc type=url link="/wxsite/ordershow/orderid/<{$order['id']}>"}>';
 		 window.location.href= url;
	
	<{/if}>
 });
		var myScroll;
function loaded() {
	myScroll = new iScroll('wrapper', {
		useTransform: false,
		onBeforeScrollStart: function (e) {
			var target = e.target;
			while (target.nodeType != 1) target = target.parentNode;

			if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA')
				e.preventDefault();
		}
	});
}
document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false); 
document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);
</script>
 <{/block}>
<{block name=blockcontent}> 
  

	 <div id="wrapper" style="top:40px;"> 
	<div id="scroller">
	
	
<{if $order['paytype'] == 1 && $order['paystatus'] == 0}>
<!--订单名称-->
  <div class="balchaordcon">
 <div class="balchaordBox">
  <ul>
   <li><a>订单名称：</a><span>订单支付</span></li>
   <li><a>订单金额：</a><span>￥<{$order['allcost']}></span></li>
  </ul>
 </div>
</div>
<div class="balchaordec"></div>
<!--支付方式-->
<div class="balchapaymamoy">
 <ul>
  <li><span>还需支付：</span></li>
  <li><b>￥<{$order['allcost']}></b></li>
 </ul>
</div>

<{foreach from=$paylist   item=items}>
<div class="balchapayma"  data="<{$items['code']}>"  payurl="<{$items['pay_url']}>">
 <ul>
  <li class="balchapaymaL">
  <{if $items['code'] == 'W'}>
  <i class="balchawx"></i>
  <{else}>
  <i style="width: 25px;height: 25px;background-image: url(http://eat.banklay.cn/templates/m7/public/wxsite/images/0511.png);"></i>
  <{/if}>
  </li>
  <li class="balchapaymaC"><span><{$items['name']}></span></li>
  <li class="balchapaymaR"><label>
  <{if $items['check']== 1}>
  	<input type="radio" name="one"><i class="balchacirc1 balchacirc2"></i></label></li>
  <{else}>
 	  <input type="radio" name="one"><i class="balchacirc1"></i></label></li>
  <{/if}>
 </ul>
</div>

<{/foreach}>
 

<input type="hidden" name="paydotype" id="paydotype"  value="">
<input type="hidden" name="payurl" id="payurl" value="">

<div class="intexchabutt" id="dopay" style="margin-top:20px;"><input type="button" value="确认支付" class="intexbg1"></div>
 
	 
 <script type="text/javascript"> 
 
 
 $(".balchapayma").bind('click',function(){
	$(".balchacirc1").removeClass('balchacirc2');
	$(this).find('.balchacirc1').addClass('balchacirc2');
	$('input[name="paydotype"]').val($(this).attr('data'));
	$('input[name="payurl"]').val($(this).attr('payurl'));
 });
 
 var biaoqianval = false;
function bqzhi(){
	biaoqianval  = false;
}
	
	
 
 	var nowbid = "";
 	 $(function(){ 
 		<{foreach from=$paylist   item=items}>

 		  <{if $items['check']== 1}>
 		  		$('#paydotype').val("<{$items['code']}>");
 		  		$('#payurl').val("<{$items['pay_url']}>");
 		  <{else}>
 		 	  
 		  <{/if}>

 		<{/foreach}>
       $('#dopay').bind("click", function() {   
	   
	   
	   if(biaoqianval == false){
				biaoqianval  = true;
		
						if($('input[name="paydotype"]').val() == ''){
							 setTimeout("bqzhi()", 500 ); 
						   Tmsg('请选择在线支付方式');
						   return;
						 }
						var payurl = $('#payurl').val();
						 if($('input[name="paydotype"]').val() == 'W'){
							 setTimeout("bqzhi()", 500 ); 
							  var uass = window.navigator.userAgent.toLowerCase(); 
								if(uass.match(/MicroMessenger/i) == 'micromessenger'){ 
									window.location.href = payurl;
								}
						 }	 
						 else if($('input[name="paydotype"]').val() == 'membercard'){
						        $.ajax({         //script定义
					                 url: payurl,
					                 dataType: "json",
					                 async:true,
					                 data:{datatype:'json'},
					                 success:function(content) { 
					                 	if(content.error ==  false){
					                 	    window.location.href=  content.msg ;
					                 	}else{
					                 		Tmsg(content.msg);
					                 	}
					                  	//$('#loading').toggle();
					                 	setTimeout("bqzhi()", 500 ); 
					                 
					                 },
					                 error:function(){
					                  //$('#loading').toggle();
					                	 setTimeout("bqzhi()", 500 ); 
					                 }
					        }); 
						 }
						 else {
							 setTimeout("bqzhi()", 500 ); 
						 }
						 
					 
					
       	}
       	
       });
 	 });



</script>  
 	<{/if}>

</div>

</div>
 
<{/block}>
 
	
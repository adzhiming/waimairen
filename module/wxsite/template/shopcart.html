 <{extends file="<{$tempdir}>/public/wxsite.html"}>  
<{block name=extendcss}> 
<link rel="stylesheet"  href="<{$siteurl}>/templates/<{$tempdir}>/public/wxsite/css/mycss.css">   
<{/block}>
<{block name=extendjs}>  
  <script src="<{$siteurl}>/templates/<{$tempdir}>/public/wxsite/js/wxshop.js?"></script>  
  <script src="<{$siteurl}>/templates/<{$tempdir}>/public/wxsite/js/template.min.js"></script> 
<script src="<{$siteurl}>/templates/<{$tempdir}>/public/wxsite/js/cart.js?t=5"></script>  
 <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=<{$baidumapkey}>"></script>
 <style>
 .jifenshow{
		height:100px;
		OVERFLOW-Y: auto;
	  OVERFLOW-X: hidden;
	  overflow:hidden;
	}
 
 .center{display: -webkit-box; -webkit-box-align: center; -webkit-box-pack: center;height: 100%;}
 .box {
	    padding: 2%;
	}
 .cmd_title {
	    background-color: #01D101;
	    text-align: center;
	    color: #fff;
	    border-radius: 5px;
	    height: 30px;
	    line-height: 30px;
	    font-weight: 600;
	    font-size: 1.2em;
	}
 
 .box_li{margin-top: 3%;border-radius: 8px;height: 150px;position: relative;     padding:0px 0px 0px 0px;margin-left: 0;}
 .box_li a{display: block;height: 100%;border-radius: 8px;}
 .cmd_bg{width: 100%;border-radius: 8px;height: 100%;}
 .cmd_logo{width: 80px;height: 80px;border-radius: 100%;}
 .zz_alert{position: absolute;top: 0;left: 0;width: 100%;height: 100%;background-color: rgba(0,0,0,.1);color: #fff;border-radius: 8px;}
 .zz_left{width: 30%;float: left;height: 100%;}
 .zz_right{width: 70%;float: left;height: 100%; -webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;}
 .zz_right h3,h4{font-weight: inherit;} .mar4{margin-top: 4%;color: #333;font-size: 14px;}
 .mar5{margin-top: 5%;} .font-s{font-size: 1.1em;} .font-sa{font-size: 1.2em;}

 .padd3{padding:3%;}
 .padd5{padding:7% 5% 7% 0;}

 .justify{display: -webkit-box; display:box; -webkit-box-pack:justify; box-pack:justify; }
 .vertical{ -webkit-box-orient: vertical;height: 100%;}
 .text-right{text-align: right;}
 .text-center{text-align: center;}
 .ellipsis {overflow: hidden;white-space: nowrap;text-overflow: ellipsis;}
 .ellipsis-1 {display: -webkit-box; overflow: hidden; white-space: normal!important;text-overflow: ellipsis; word-wrap: break-word; -webkit-line-clamp: 2; -webkit-box-orient: vertical;}
 .font-s{font-size: 1.1em;} 
 
 .zz_alert div, .zz_alert h2, .zz_alert h3,.zz_alert h4{color: #fff;}
 
 .coupon_li{margin-top: 3%;    display: list-item;text-align: -webkit-match-parent;    
 	border-radius: 8px;height: 100px; position: relative;}
 .coupon_box {
	    padding: 0 5%;
	    position: absolute;
	    left: 0;
	    top: 0;
	    width: 100%;
	    height: 100%;
	    border-radius: 8px;
	    color: #333;
 		box-sizing: border-box;
 -webkit-box-sizing: border-box;
 -moz-box-sizing: border-box;
	}
 
 .coupon_tip {
	    background: url(<{$siteurl}>/templates/<{$tempdir}>/public/wxsite/images/button.png)no-repeat;
	    background-size: 100% 100%;
	    color: #fff;
	    display: block;
	    padding: 5px 10px;
	    margin: 0 5%;
	}
 .coupon_name {
	    color: #333;
	    font-size: 12px;
	    font-weight: bold;
	    text-align: center;
	}
 .box-align {
	    -webkit-box-align: center;
	}
 .coupon_logo {
	    width: 40px;
	    height: 40px;
	    border-radius: 100%;
	}
 .flex {
	    -moz-box-flex: 1;
	    -webkit-box-flex: 1;
	    box-flex: 1;
	    -ms-flex: 1;
	}
 
 button {
	    border: none;
	    outline: none;
	    border-radius: 5px;
	    color: #fff;
	    font-family: 'Microsoft YaHei',Arial,Helvetica,sans-serif;
	    font-weight: 600;
	    font-size: 1.2em;
	}
 
 .use_btn {
	    background-color: #5EE088;
	    padding: 6px 15px;
 		visibility: hidden;
	}
 
 </style>
<script>
    var shopid = <{$id}>;
    var cartbagcost =0;
    var cartpscost = 0;
    var  cartsum = 0;
    var cxcost = 0;
    var surecost = 0;
    var juanlist = <{$juanlist|json_encode}>;
    var wxjuanlist = <{$wxjuanlist|json_encode}>;
    var membercardlist = <{$membercardlist|json_encode}>;
    
    var checknext = false;
    var timelist = <{$timelist|json_encode}>;
    var backgoshop = '<{ofunc type=url link="/wxsite/shopshow/id/<{$id}>"}>';
    var backadd = '<{ofunc type=url link="/wxsite/bkaddress/shopid/<{$id}>"}>';
    var mid = '<{$mid}>';
    
 
    function selectCoupon(cardId, cardName){
    	if(checknext ==  false){ 
        	checknext = true;

     $('#couponcode').val(cardId);
     $('#couponinfo').text(cardName);
      $('#mask1').hide();
    	$('#popup1').hide();
    	 myScroll.destroy();
    	 myScroll = new iScroll('wrapper', {
    		useTransform: false,
    		bounce:false,
    		onBeforeScrollStart: function (e) {
    			var target = e.target;
    			while (target.nodeType != 1) target = target.parentNode;

    			if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA')
    				e.preventDefault();
    		}
    	}); 
    	setTimeout("myyanchi()", 500 );
     }
    	
   	 	freshcart('<{$mid}>');
    }
 function doselectcoupon(){
    if(checknext ==  false){ 
        checknext = true;
    	var membercardcode = $('#membercardcode').val();
    	var totalamount = surecost;//Number($('#orderamount').val());
	    	
	     $('#loading').show();
	   	  url = siteurl+'/index.php?mid='+mid+'&ctrl=wxsite&action=getCouponListByMemberAndAmount&datatype=json&random=@random@';
	   	  url = url.replace('@random@', 1+Math.round(Math.random()*1000));
	      $.ajax({         //script定义
	               url: url.replace('@random@', 1+Math.round(Math.random()*1000)),
	               dataType: "json",
	               async:true,
	               data:{'membercardcode':membercardcode,'totalamount':totalamount},
	               success:function(content) { 
	               	if(content.error ==  false){
	               		if (content.msg) {
	               			var couponList = null;
	               			if (content.msg.coupon) {
	               				couponList = content.msg.coupon;
	               			}
	               			showcouponlist(couponList);
	               		}
	               		else {

	               		}                 	
	               	}else{
	               		Tmsg(content.msg);
	               	}
	                	$('#loading').toggle();
	               
	               },
	               error:function(){
	                $('#loading').toggle();
	               }
	      }); 
      
    	setTimeout("myyanchi()", 500 );
     }
  }
    
 function showcouponlist(couponList){

 	 var oldcouponcode = $('#couponcode').val();
 	var htmle = '';
 	if(couponList && couponList.length > 0){
 		var htmle = '';
 		var checkcost = Number(surecost);
  		$.each(couponList,function(i,field){  

  			var id = field.id;
  			var name = field.name;
  			var code = field.code;
  			var type = field.type;
  			var typestr = field.typestr;
  			var bgpath =  field.bgpath?field.bgpath:'';
  			var logopath =  field.logopath?field.logopath:'';
  			var discount =  Number(field.discount?field.discount:0);
  			var balance =  Number(field.balance?field.balance:0);
  			var leastmoney =  Number(field.leastmoney?field.leastmoney:0);
  			var amount =  Number(field.amount?field.amount:0);
  			var end_time= field.end_timestamp?field.end_timestamp:'';


			   	 
			   	htmle +='<li class="coupon_li" onclick="selectCoupon(\'' + code + '\',\'' + name +'\');">'
			   	htmle +='    <img src="' + bgpath +'" class="cmd_bg">';
			   	htmle +='     <div class="justify box-align coupon_box">';
			   	htmle +='        <div class="center vertical">';
			   	htmle +='            <img src="' + logopath + '" class="coupon_logo">';
			   	htmle +='            <div class="coupon_name">' + typestr +'</div>';
			   	htmle +='        </div>';
			   	htmle +='        <h4 class="coupon_tip flex ellipsis">' + name + '</h4>';
			   	htmle +='        <button type="button" class="use_btn">&nbsp;</button>';
			   	htmle +='     </div>';
			   	htmle +=' </li>';

 		});
 	
 		
 	}
 	
	if(htmle == ''){
		  Tmsg('无满足条件的优惠券');
		}else{
			 htmle = '<div class="cmd_title" onclick="selectCoupon(\'0\',\'不使用优惠券\');">不使用优惠券</div>'+htmle;

			 
		  myScroll.scrollToElement('#couponList',100); 
	      //	 myScroll.scrollTo(0,Number(defaultheight)*-1,200,false); 
 	    //  myScroll.refresh();
 	         setTimeout(function () {
 	        	loadhtmlCouponList(htmle,'#couponList');
	           }, 100);
	           /*
			
	         
	          myScroll.destroy();
	          myScroll = new iScroll('outdivshow', {hScrollbar:false, vScrollbar:false,bounce:false});    */
	}
	
 	setTimeout("myyanchi()", 500 );
 }
 
 function loadhtmlCouponList(htmlbottom,elmid){
 	myScroll.destroy();
 	htmlbottom = '<div class=" box " id="outdivshow"><ul class="couponList clearfix">'+htmlbottom+'</ul></div>  ';
 	      	 $('#popcontent').html(htmlbottom);
 	  	 	  $('#mask1').show();
 	        $('#popup1').show();
 	        var allheight = $(window).height();
 	          // var bottom = $("#jifenposition").offset().bottom;//元素相当于窗口的左边的偏移量
              var top = $(elmid).offset().top;//元素相对于窗口的上边的偏移量 
                allheight = Number(allheight)-100;  
 			 //  alert(0);
              top = Number(top)+40;
 			 
 			   var  kuangheight = allheight;
 				var kheight  =(allheight)/2;
 	           $('#popup1').css({'top':'50%'});
 	           $('#popup1').css({'marginTop':-kheight});
 	          
 	       //    $('#outdivshow').css({'height':allheight}); 
		
 	           $('#outdivshow').css({'height':kuangheight});      
 	          myScroll = new iScroll('outdivshow', {hScrollbar:false, vScrollbar:true,bounce:false});   
 }
 function resetCoupon() {
	 $("#couponcode").val('');
	 $("#couponinfo").text('未使用优惠券');
 }
 
    function selectMemberCard(cardId, cardName){
    	if(checknext ==  false){ 
        	checknext = true;

     $('#membercardcode').val(cardId);
     $('#membercardinfo').text(cardName);
      $('#mask1').hide();
    	$('#popup1').hide();
    	 myScroll.destroy();
    	 myScroll = new iScroll('wrapper', {
    		useTransform: false,
    		bounce:false,
    		onBeforeScrollStart: function (e) {
    			var target = e.target;
    			while (target.nodeType != 1) target = target.parentNode;

    			if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA')
    				e.preventDefault();
    		}
    	}); 
    	setTimeout("myyanchi()", 500 );
     }
    	resetCoupon();
   	 	freshcart('<{$mid}>');
    }
    
    function loadhtmlMemberCard(htmlbottom,elmid){
    	myScroll.destroy();
    	htmlbottom = '<div class=" box " id="outdivshow"><ul class="cmd_box">'+htmlbottom+'</ul></div>  ';
    	      	 $('#popcontent').html(htmlbottom);
    	  	 	  $('#mask1').show();
    	        $('#popup1').show();
    	        var allheight = $(window).height();
    	          // var bottom = $("#jifenposition").offset().bottom;//元素相当于窗口的左边的偏移量
                 var top = $(elmid).offset().top;//元素相对于窗口的上边的偏移量 
                   allheight = Number(allheight)-100;  
    			 //  alert(0);
                 top = Number(top)+40;
    			 
    			   var  kuangheight = allheight;
    				var kheight  =(allheight)/2;
    	           $('#popup1').css({'top':'50%'});
    	           $('#popup1').css({'marginTop':-kheight});
    	          
    	       //    $('#outdivshow').css({'height':allheight}); 
		
    	           $('#outdivshow').css({'height':kuangheight});      
    	          myScroll = new iScroll('outdivshow', {hScrollbar:false, vScrollbar:true,bounce:false});   
    }
    
  
    function doselectmembercard(){
    	if(checknext ==  false){ 
        	checknext = true;
    	 var oldmembercardcode = Number($('#membercardcode').val());
    	if(membercardlist && membercardlist.length > 0){
    		var htmle = '';
    		var checkcost = Number(surecost);
     		$.each(membercardlist,function(i,field){  

     			var id = field.id;
     			var name = field.name;
     			var code = field.code;
     			var bgpath =  field.bgpath?field.bgpath:'';
     			var logopath =  field.logopath?field.logopath:'';
     			var discount =  Number(field.discount?field.discount:0);
     			var balance =  Number(field.balance?field.balance:0);
     			var giveamount =  Number(field.giveamount?field.giveamount:0);
     			var end_time= field.end_timestamp?field.end_timestamp:'';
     			var strDis = '';
     			var floatTmp  = 0;
     			if (discount> 0) {
     				floatTmp = discount*10;
     				floatTmp = Math.round(floatTmp*100)/100;
     				strDis = "" + floatTmp + "折";
     			}
     			var strBalance='';
    			floatTmp = Math.round(balance + giveamount)/100;
     			strBalance = "" + floatTmp + "元";
     			
			   	 var temp_pre = oldmembercardcode == field.id ?'on':'';
			   	 
                       
    			//htmle +='<li class="'+temp_pre+'" onclick="selectjuan(\''+code+'\',\''+code+'\',\''+code+'\',\''+code+'\');">'+code+'</li>';
    			htmle +='<li class="box_li" onclick="selectMemberCard(\'' + code + '\',\'' + name +'\');">'
    			htmle +='<img src="' + bgpath + '" class="cmd_bg">'
        		htmle +='<div class="zz_alert">'
        			 //<!--logo-->
        		htmle +='  <div class="zz_left">'
        		htmle +='    <div class="center">'
        		htmle +='        <img src="'+ logopath + '" class="cmd_logo">'
        		htmle +='    </div>'
        		htmle +='</div>'
                    //<!--信息展示-->
        		htmle +='<div class="zz_right padd3">'
        		htmle +='    <div class="justify vertical">'
        		htmle +='        <h3 class="text-right">' + code + '</h3>'
        		htmle +='        <div class="mar5">'
        		htmle +='            <h2 class="ellipsis">'+ name + '</h2>'
        		htmle +='            <div class="justify font-s">'
        		htmle +='                <div>折扣：' + strDis + '</div>'
        		htmle +='                <div>余额：' + strBalance + '</div>'
        		htmle +='            </div>'

        		htmle +='        </div>'
        		htmle +='        <h4>有效期：' + end_time + '</h4>'
        		htmle +='    </div>'
        		htmle +='</div>'
        		htmle +='</div>'
        		htmle +='</li>' 	
    		});
    		if(htmle == ''){
    		  Tmsg('无满足条件的会员卡');
    		}else{
    			 htmle = '<div class="cmd_title" onclick="selectMemberCard(\'0\',\'不使用会员卡\');">不使用会员卡</div>'+htmle;

    			 
    		  myScroll.scrollToElement('#memberCardList',100); 
    	      //	 myScroll.scrollTo(0,Number(defaultheight)*-1,200,false); 
      	    //  myScroll.refresh();
      	         setTimeout(function () {
      	        	loadhtmlMemberCard(htmle,'#memberCardList');
    	           }, 100);
    	           /*
    			
    	         
    	          myScroll.destroy();
    	          myScroll = new iScroll('outdivshow', {hScrollbar:false, vScrollbar:false,bounce:false});    */
    		} 
    		
    	}else{
    	  Tmsg('您未绑定会员卡');
    	  $('#mask').hide();
    	  $('#popup2').hide();
    	}
    	setTimeout("myyanchi()", 500 );
     }
    }
    
    $(function(){ 
	
		 var cururl = window.location.href; 
		 $.cookie('wxCurUrl', cururl); 
		 <{if $member['uid'] <= 0 }>
			window.location.href= siteurl+'/index.php?mid=<{$mid}>&ctrl=wxsite&action=login';
		 <{/if}>
		   maketime();
    	 freshcart('<{$mid}>');
    
    	 
    	 $('#outpay').bind("click", function() {   
    	 	 $(this).find('li i').addClass('shopcaoaA onpay');
	         $('#outonline').find('li i').removeClass('shopcaoaA onpay');
             freshcart('<{$mid}>');
			 redefinejuan();
             myScroll.refresh();
        });
    	  $('#outonline').bind("click", function() {   
	          $(this).find('li i').addClass('shopcaoaA onpay');
	          $('#outpay').find('li i').removeClass('shopcaoaA onpay');
              freshcart('<{$mid}>');
			  redefinejuan();
              myScroll.refresh();
        });
    	 
    	 
    	 
    	 
    });
	function redefinejuan(){
		$("#juanshuoming").text('未选择优惠券');
		$("#juanid").val(0);
	}
    function myyanchi(){
  		
  		  checknext = false;
  	}
 </script>
  <script id="cartlist" type="text/html">   
 
   <li><span class="shopdetalistL"><^%=list.name%^><^%if(list.have_det==1){%^><font style="color:#ccc;font-size:10px;">【<^%=list.gg.attrname%^>】<font><^%}%^></span><span class="shopdetalistC">x<^%=list.count%^></span><span class="shopdetalistR">￥<^%=list.cost%^></span></li>
 
 </script>
<{/block}>
<{block name=sitetitle}><{$sitename}><{/block}>
<{block name=hearnav}>
  
<!--标题-->
 <{load_data assign="info" table="address" type="one" where="id='<{$id}>' and userid = '<{$member['uid']}>'" fileds="*" }> 

	<!--标题-->
<div class="toptitCon">
 <div class="toptitBox addressbox" >
 <div class="toptitL" ><i></i></div>
  <div class="toptitC"><h3>购物车下单</h3></div>
  </div>
 
 <div class="mapaddressbox toptitBox" style="display:none; padding:0px; height:49px;">
 <!--搜索框-->
 
<div class="searchCon" >
 <div class="toptitL" style="margin-top:5px;"><i></i></div>
 <div class="searchBox" style="float:left; margin-left:15px; width:80%; height:32px;">
 <input style="height:32px; line-height:32px; padding-left:25px; font-size:14px;width:100%;" type="text" id="searchKeywords"  onkeyup="getscraddress();" placeholder="搜索地址"><i></i></div>
</div>

</div>
 
 
</div>


<{/block}>
<{block name=footer}><{/block}>
<{block name=myScrolljs}>
<script> 
		var myScroll;
		var outdiv = false;
		var myScroll2;
    var myScroll3;
function loaded() { 

	myScroll = new iScroll('wrapper', {
		useTransform: false,
		bounce:false,
		onBeforeScrollStart: function (e) {
			var target = e.target;
			while (target.nodeType != 1) target = target.parentNode;

			if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA')
				e.preventDefault();
		}
	});
   myScroll2 = new iScroll('scroll_address_2',{hScroll:false,hScrollbar:false, vScrollbar:false}); 
	 myScroll3 = new iScroll('scroll_ditu',{hScroll:false,hScrollbar:false, vScrollbar:false}); 
	  
} 
document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false); 
document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);
// $(function(){
// 	var getscreenwidth = $(window).width();
// 	var inputWidth = getscreenwidth-58;
// 	$(".newaddBox ul li input").css('width',inputWidth+'px');
	 
// });
</script>
<{/block}>
  <{block name=footer}><{/block}>
<{block name=blockcontent}> 
<style>
#scroll_address_2 { 
    z-index: 99999999999999;
    top: 42px;
    bottom:0px;
    left: 0;
    width: 100%;
     position:absolute;
	margin-bottom:10px;
}
#scroll_ditu { 
    z-index: 99999999999999;
    top: 42px;
    bottom:0px;
    left: 0;
    width: 100%;
     position:absolute;
  margin-bottom:10px;
}
.tipStyle{padding: 7px 2.7%;box-sizing: border-box; font-size: 14px;color: #555;}
</style>
<div id="gdcart">
 
 
	 <div id="wrapper" style="top:40px;bottom:54px;overflow:auto!important; "> 
	<div id="scroller">
	
 	

	<!--已存在地址-->
	<{if $deaddress['contactname'] != '' ||  $deaddress['phone'] != '' || $deaddress['address'] != '' }>
<div class="shopcaorderadd" onclick="changeaddress2();">
 <ul>
  <li class="shopcaoaddL">
   <div class="shopcaoaddLname">
   <span id="show_myname"><{$deaddress['contactname']|default:''}></span>
   <b id="show_myphone"><{$deaddress['phone']|default:''}></b></div>
   <div class="shopcaoaddLad" id="show_myaddress"><{$deaddress['address']|default:''}></div>
  </li>
  <li class="shopcaoaddR"><i class="fa fa-angle-right"></i></li>
 </ul>
</div>
	<{else}>
	 
		
	<!--未保存地址-->
<div class="shopcaorderadd"   onclick="baitchangeaddress2();">
 <ul>
  <li class="shopcaoaddL"><span class="shopcaoaddLq"><i class="shopicoadd"></i>添加/选择收货地址</span></li>
  <li class="shopcaoaddR"><i class="fa fa-angle-right"></i></li>
 </ul>
</div>
	
	<{/if}> 
	
<{if $shopinfo['is_preeat'] == 1 && $shopshowtype =='dingtai'}>
<div class="shopcaorderCon tipStyle">温馨提示：确定先吃后付前，选择会员卡或优惠券能享受优惠，未选择则不享受优惠。</div>
<{else}>
<!--配送时间-->
<input type="hidden" name="addpscost" id="addpscost" value="0"> 
<div class="shopcaorderCon">
 <ul  id="Timeposition">
  <li class="shopcaodername">配送时间</li>
  <li class="shopcaoderbox"  onclick="doselectTime();" id="DeliveryTimesm" >未选择配送时间</li>
  <input type="hidden" name="DeliveryTime" id="DeliveryTime" value="0">
 </ul>
 <ul>
  <li><input type="text" placeholder="添加备注" name="remark" class="shopremar">

  </li>
 </ul>
</div>
<{/if}>	
	
	
<!--支付方式-->

<div class="shopcaorderCon"  id="payway">

<{if !( ( $open_acout == 1 || $shopinfo['is_onlinepay'] == 0 ) && ( $is_daopay == 0 || $shopinfo['is_daopay'] == 0 ) )}>
	<{if $is_daopay == 1 && $shopinfo['is_daopay'] == 1 }>
		 <ul  id="outpay" >
		  <li class="shopcaodername">货到付款</li>
		  <li class="shopcaoderbox"><i  data="0" class="shopcaoderxz shopcaoaA onpay"></i><input type="radio"  class="shopayment"></li>
		 </ul>
	<{/if}>
	<{if $open_acout == 1 ||  $shopinfo['is_onlinepay'] == 1 }>
		 <ul  id="outonline">
		  <li class="shopcaodername">在线支付</li>
		  <li class="shopcaoderbox"><i  data="1" class="shopcaoderxz <{if $is_daopay == 0 || $shopinfo['is_daopay'] == 0 }> shopcaoaA  onpay  <{/if}>"></i><input type="radio"   class="shopayment"></li>
		 </ul>
	<{/if}>
 <{else}>
 
  <ul>
  <li class="shopcaodername">未开启支付</li>
  <li class="shopcaoderbox"><i class="shopcaoderxz"></i><input type="radio"   class="shopayment"></li>
 </ul>
 
 
<{/if}>
 
</div>	
<input type="hidden" name="orderamount" id="orderamount" value="0">
<{if $member['uid'] > 0 }>
<!--会员卡-->
<div class="shopcaorderCon" >
 <ul  id="memberCardList">
  <li class="shopcaodername">会员卡</li>
  <li class="shopcaoderbox" ><span class="shopcoupon"  onclick="doselectmembercard();" id="membercardinfo">未使用会员卡<i class="fa fa-angle-right"></i></span></li>
   <input type="hidden" name="membercardcode" id="membercardcode" value="0"><input type="hidden" name="juancost" id="juancost" value="0">
 </ul>
</div>

<!--优惠券-->
<div class="shopcaorderCon" >
 <ul  id="couponList">
  <li class="shopcaodername">优惠券</li>
  <li class="shopcaoderbox" ><span class="shopcoupon"  onclick="doselectcoupon();" id="couponinfo">未使用优惠券<i class="fa fa-angle-right"></i></span></li>
   <input type="hidden" name="couponcode" id="couponcode" value="0">
 </ul>
</div>

<!--优惠券 旧的-->
<!--
<div class="shopcaorderCon" >
 <ul  id="yhjposition">
  <li class="shopcaodername">优惠券</li>
  <li class="shopcaoderbox" ><span class="shopcoupon"  onclick="doselectjuan();" id="juanshuoming">未使用优惠券<i class="fa fa-angle-right"></i></span></li>
   <input type="hidden" name="juanid" id="juanid" value="0"><input type="hidden" name="juancost" id="juancost" value="0">
 </ul>
</div>
-->

<!--积分抵扣-->
<!--
<div class="shopcaorderCon" >
 <ul  id="jifenposition">
  <li class="shopcaodername">积分抵扣</li>
  <li class="shopcaoderbox" ><span class="shopcoupon"  onclick="doselectjifen('<{$scoretocost}>','<{$member['score']|default:0}>');" id="jifenshuoming">选择抵扣金额<i class="fa fa-angle-right"></i></span></li>
   <input type="hidden" name="jifen" id="jifen" value="0">
 </ul>
 
</div>
-->

<{/if}>

<!--订单清单-->
<div class="shopcaorderCon">
 <ul>
  <li class="shopcaodername"><{$shopinfo['shopname']}></li>
  <li class="shopcaoderbox"><span class="shopdiatc"><{if $shopinfo['sendtype'] == 0 }>网站<{else}>商家<{/if}>配送</span></li>
 </ul>
</div>

<div class="shopdetalistCon">
 <div class="shopdetalistBox">
  <ul  id="shocart">
   
   
  </ul>
  <ul id="nextshocart">
   
  </ul>
 </div>
</div>	
 
  
  
  <script>
	$(function(){
		$("#mask1").click(function(){
			$("#mask1").hide();
			$("#popup1").hide();
		});
	});
	
  </script>
  
 <div id="mask1">
	  </div>
	  <div id="popup1" class="popup1" style="background:none; border:none;"> 
	  	 <div class="popcontent" id="popcontent" style="width:95%; background:#fff; margin:0 auto;">
	  	 	    
	  	 	  
	  	 	   
	  	 </div>
	  </div>
	  
	  
 </div>
 
 <div id="mask2" class="mask">
 </div>
 <div id="popup2" class="popup1" style="background:none; border:none;"> 
 	 <div class="popcontent" id="popcontent2" style="width:65%; background:#fff; margin:0 auto;">
 	 	    
 	 	  
 	 	   
 	 </div>
 </div>
 
 
</div>
</div>
<!--区域信息-->
      <{if $shopinfo['is_preeat'] == 1 && $shopshowtype =='dingtai'}>
        <div class="mybottom">
          <div class="center">
              <div class="flex intexchabutt" onclick="orderSubmit('<{$mid}>','','<{$shopid}>','');"><input type="button"  value="立即下单" class="intexbg1"></div>
              <div class="flex intexchabutt" onclick="orderSubmit('<{$mid}>','xchf','<{$shopid}>','<{$tableid}>');"><input type="button"  value="先吃后付" class="intexbg1"></div>
                  
          </div>
        </div> 
      <{else}>
      <div class="mybottom" style="bottom:-20px;">
          <div class="intexchabutt"  onclick="orderSubmit('<{$mid}>','','<{$shopid}>','');"><input type="button"  value="立即下单" class="intexbg1"></div>
        </div> 
       
      <{/if}>

</div>
 
 
 
 <style>
 .mybottom{bottom:0px; left:0px;}
 .intexchabutt{margin-top: 0;}
 .newadd li .newinp {
    width: 200px;
  margin-left: 0px;
    font-size: 14px;
}
.newadd {width:100%;}
.newadd li {
    border-bottom: 1px solid #e8e8e8;
    line-height: 42px;}
 </style>
 
 
 
 
 <div class="addressmask" id="otheraddress" style="display:none;">
    <div id="addareass_1">
	
	
    <div class="addressbox">
			<input type="hidden" name="add_addressid" value="0"  >
            <!--联系人-->
            <div class="newaddCon">
                <div class="newaddBox">
                    <ul class="newadd">
                        <li><a>&nbsp;&nbsp;&nbsp;姓名：</a><input type="text" placeholder="请填写收货人的姓名" id="contactname" value="<{$info['contactname']}>" name="" class="newinp"></li>
                        <li><a>&nbsp;&nbsp;&nbsp;手机：</a><input type="text" placeholder="请填写收货人手机号" id="mobile" name="phone" value="<{$info['phone']}>" class="newinp"></li>
                        <{if $areacode== 1}>
                        <li id="showgetcode" class="signmehide">
                            <i class="signinmess"></i>
                            <input type="text" name="check_message" id="phoneyan"   value="" placeholder="输入短信验证码">
                            <input type="button"  onclick="clickyanzheng();"   time="0" id="dosendbtn"  value="发送到手机" class="signmeinput">
                        </li>
                        <{/if}>
                        <{if $addAreaType == 1}>
                        <li style=" height:44px; ">
                            <a>&nbsp;&nbsp;&nbsp;地址：</a><input type="text" placeholder="输入收货人详细地址（如单元、门牌号等）" value="<{$info['address']}>" class="newinp1" style="width:79%;margin-left:0px;">
                        </li>
                        <{else}>
                        <li style=" height:44px; ">
                            <a style="float:left;">&nbsp;&nbsp;&nbsp;小区/大厦/学校：</a>
                            <div lng="<{$info['lng']}>" lat="<{$info['lat']}>"  style="float:left; height:44px; line-height:44px;margin-left:20px;" type="text" onclick="getmapaddress();" class="newinp1"><{$info['bigadr']|default:'点击选择地址'}></div>
                        </li>
                        <div class="clear"></div>
                        <li><a>&nbsp;&nbsp;&nbsp;详细地址：</a><input type="text" placeholder="例：16号楼107室" value="<{$info['detailadr']}>" class="newinp2"/></li>
                        <{/if}>
                    </ul>
                </div>
            </div>
            <div class="intexchabutt"  onclick="saveaddress();" style="margin-top:15px;"><input type="button"  value="保存地址" class="intexbg1"></div>
        </div>

 

 
<div id="scroll_ditu" style="display: none;"> 
 <div class="mapaddressbox"  style="display:none;">
 <!--暂时屏蔽地图-->
<div class="showmapbox" style="display: none">
		 <div class="mapditu" id="map">
			
		 </div>
		 <div id="marker_red_sprite"><img src="<{$siteurl}>/upload/map/marker_red_sprite.png" /></div>
	</div> 
 

<div id="choiceguidebox" >
	<ul>
	<!--     <li>
			<div class="addresslist">
				<p class="choicegudie">郑州大学新校区</p>
				<p class="choicedetgudie">郑州大学新校区郑州大学新校区郑州大学新校区郑州大学新校区</p>
			</div>
		</li>   -->
	</ul>
</div>
</div>
</div>


 

    </div>
<div id="scroll_address_2">
	<div id="address_2">
	     
	  
	</div>
</div>		
 </div>
   <script type="text/javascript"> 
    	
     $(function(){     
      // var heightvar = $(window).height() -70;
     
	  getadmylist();
       
     });
	 //获取所有用户数据   
	 function getadmylist(){
	  if(checknext ==  false){ 
    	 checknext = true; 
     	$('#loading').show();
		$('#address_2').html('');
     	  url ='<{ofunc type=url link="/wxsite/myajaxadlist/shopid/<{$id}>/random/@random@/datatype/json"}>';
     	  url = url.replace('@random@', 1+Math.round(Math.random()*1000));
           $.ajax({         //script瀹氫箟
                 url: url.replace('@random@', 1+Math.round(Math.random()*1000)),
                 dataType: "json",
                 async:true,
                 data:{},
                 success:function(content) { 
                 	if(content.error ==  false){
					  if(content.msg.length == 0){
					     $('#addareass_1').show();
						    $('#address_2').hide();
						 
					  }else{
					      $('#address_2').show();
						   $('#addareass_1').hide();
						  var tempcontent = '<div class="myaddressCon"   onclick="edite_myaddress(this)"   id_data="" contactname="" sex="" phone=""  lat=""  lng=""   bigadr="点击选择地址"   detailadr=""   add_new=""  > <div class="myaddressBox"><i>添加收货地址</i></div> </div> ';
							$('#address_2').append(tempcontent);
							
 						   for(var i=0;i<content.msg.length;i++){
						       var tempinfo = content.msg[i]; 
							   
							   
											if (tempinfo.sex == 1){
												var sexname = '先生';
											}else if (tempinfo.sex == 2){
												var sexname = '女士';
											} 
											if (tempinfo.default == 1){
												var defaultdiv = ' <i  id="default_icon_'+tempinfo.id+'" class="difyd"></i> ';
											}else{
												var defaultdiv = ' <i  id="default_icon_'+tempinfo.id+'"  class="difwb setdefault"   gid="'+tempinfo.id+'"></i> ';
											}
											if (tempinfo.default == 1){
												var setdefault = ' 	  <span  id="default_text_'+tempinfo.id+'">默认地址</span> ' ;
											}else{
												var setdefault = ' 		  <span   id="default_text_'+tempinfo.id+'" class="setdefault"    gid="'+tempinfo.id+'">设为默认</span> ';
											}
											
											if( tempinfo.bigadr == '' && tempinfo.detailadr == ''  &&  tempinfo.address != ''  ){
												var addressshow =  ' <li><p>'+tempinfo.address+'</p></li>  ';
											}else{
												var addressshow =  ' <li><p>'+tempinfo.bigadr+'<span>'+tempinfo.detailadr+'</span></p></li>  ';
											}
											 if( tempinfo.bigadr == '' && tempinfo.detailadr == ''  &&  tempinfo.address != ''  ){
												var  setaddress =  '   	 	 <li  id="dosho_my_'+tempinfo.id+'"  id_data="'+tempinfo.id+'" contactname="'+tempinfo.contactname+'" sex="'+tempinfo.sex+'" phone="'+tempinfo.phone+'"  lat=""  lng=""   bigadr=""    detailadr=""   add_new="'+tempinfo.address+'"  onclick="edite_myaddress(this)" class="bjddress"  gid="'+tempinfo.id+'"><a>编辑</a></li> '
											}else{
												var  setaddress = '   	 	 <li  id="dosho_my_'+tempinfo.id+'"  id_data="'+tempinfo.id+'" contactname="'+tempinfo.contactname+'" sex="'+tempinfo.sex+'" phone="'+tempinfo.phone+'"  lat="'+tempinfo.lat+'"  lng="'+tempinfo.lng+'"   bigadr="'+tempinfo.bigadr+'"    detailadr="'+tempinfo.detailadr+'"   add_new="'+tempinfo.address+'"  onclick="edite_myaddress(this)" class="bjddress"  gid="'+tempinfo.id+'"><a>编辑</a></li> '
											}
											
											
							   
 							   var tempcontentlist = '<div class="defaultadd"  id="defaultaddt_'+tempinfo.id+'"> '
											 +'   	 <div class="defaultaddt"  onclick="semy_isdefault('+tempinfo.id+','+tempinfo.is_tolong+');" > '
											 +'   	  <div class="difaultbox"> '
											 +'   	   <ul class="difaultbot"> '
											+'   	 	<li> '
											+'   	 	 <ul class="difaultxx"> '
											+'   	 	  <li><a>'+tempinfo.contactname+'</a></li> '
 											+'   	 	  <li>&nbsp;'+tempinfo.phone+'</li> '
											+'   	 	 </ul> '
											+'   	 	</li> '
											+'   	    '+addressshow+'	 '
											 +'   	   </ul> '
											 +'   	  </div> '
											+'   	  </div> '
											+'   	  <div class="defaultaddb"> '
											+'   	   <div class="difaultbox"> '
											+'   	    <ul class="difaultl"  onclick="semy_isdefault('+tempinfo.id+');" > '
											+'   	 	<li><label><input type="radio" name="sex" checked="checked">'+defaultdiv+' </label></li> '
											+'   	 	<li> '+setdefault+'</li> '
											+'   	    </ul> '
											+'   	    <ul class="difaultr"> '
											+'   	   '+setaddress+' ' 
											+'   	 	<li class="deladdress" onclick="deladdress('+tempinfo.id+');"  gid="'+tempinfo.id+'"><a>删除</a></li> '
											+'   	    </ul> '
											+'   	   </div> '
											+'   	  </div> '
											+'   	 </div>';  
						 
							    $('#address_2').append(tempcontentlist);
								
								
								
								
							 
							   
						   }
					 
						   
						   
						 
					  }
                 	    	//alert(content.msg.length);
                 	}else{
                 		Tmsg(content.msg);
                 	}
                  	$('#loading').hide();
                 
                 },
                 error:function(){
                  $('#loading').hide();
                 }
        }); 
        setTimeout("myyanchi()", 500 );
	 
	    }    
	
	 }
	 function edite_myaddress(obj){ 
		 $('#contactname').val($(obj).attr('contactname'));
		 if($(obj).attr('sex') == 1){
			 $('input[name="sex"]').eq(0).attr("checked",'checked'); 
		 }
		 if($(obj).attr('sex') == 2){
			$('input[name="sex"]').eq(1).attr("checked",'checked'); 
		 }
		 $('#mobile').val($(obj).attr('phone'));		 
		 $('.newinp1').attr('lng',$(obj).attr('lng'));
		 $('.newinp1').attr('lat',$(obj).attr('lat'));
		 <{if $addAreaType == 1}>
 		 $('.newinp1').val($(obj).attr('add_new'));
		 <{else}>
		 $('.newinp1').text($(obj).attr('bigadr'));
		 <{/if}>
		 $('.newinp2').val($(obj).attr('detailadr'));
		 		 
	     $('input[name="add_addressid"]').val($(obj).attr('id_data'));
		  $('#address_2').hide("slow");
         $('#addareass_1').show("slow"); 
		 
		 $("#scroll_address_2").css('position','static');
		 $("#scroll_address_2").css('overflow','auto');
		 

	 }
	
	 function semy_isdefault(myadid,is_tolong){

      if(is_tolong == 1){
        alert("距离太远可能无法配送！");
        return false;
      }
 
	     $("#gdcart").show("slow");
	       $('#otheraddress').hide("slow");
		  var info = {'addressid':myadid}; 
	      var url = '<{ofunc type=url link="/wxsite/setmydefadid/random/@random@/datatype/json"}>';
		  var backdata = ajaxback(url,info); 
		  if(backdata.flag == false){ 
		 
		  $(".difaultl li span").text('设为默认');
		  $(".difaultl li i").removeClass('difyd');
		  $(".difaultl li i").addClass('difwb');
		  $('#default_icon_'+myadid).addClass('difyd');
		  $('#default_text_'+myadid).text('默认地址');
		  $('#show_myname').text($('#dosho_my_'+myadid).attr('contactname'));
		  $('#show_myphone').text($('#dosho_my_'+myadid).attr('phone'));
		  if( $('#dosho_my_'+myadid).attr('sex') == 1 ){
			$('#show_sex').text('先生');
		  }
		   if( $('#dosho_my_'+myadid).attr('sex') == 2 ){
			$('#show_sex').text('女士');
		  }
		  $('#show_myaddress').text($('#dosho_my_'+myadid).attr('add_new'));
		  
		  
		  
		  }else{ 
		     Tmsg(backdata.content);
		  }
	 }
	 function baitchangeaddress2(){
		$(".toptitC h3").text('管理地址'); 
	   $("#gdcart").hide("slow");
	   $('#otheraddress').show("slow");
	    $("#scroll_address_2").css('position','static');
	  $("#scroll_address_2").css('overflow','auto');
	   myScroll2.refresh();
	 }
	  function changeaddress2(){
		$(".toptitC h3").text('管理地址'); 
	   $("#gdcart").hide("slow");
	   $('#otheraddress').show("slow");
	 //   $("#scroll_address_2").css('position','static');
	 //	 $("#scroll_address_2").css('overflow','auto');
	   myScroll2.refresh();
	 }
	 
	 function deladdress(gid){ 
 	  	$('#loading').show();
 			 
	         	var info = {'tijiao':'del','addressid':gid};
	        	var url = '<{ofunc type=url link="/area/deladdress/random/@random@/datatype/json"}>';
	        	    url = url.replace('@random@', 1+Math.round(Math.random()*1000));
	          var backinfo = ajaxback(url,info);
	          if(backinfo.flag ==  false){
	            // location.reload(); 
				 $("#defaultaddt_"+gid).remove();
				 myScroll2.refresh();
	          }else{
	          	$('#loading').hide();
	             Tmsg(backinfo.content);
	          } 
 	 }
     
    	</script>
		

<script>
var map,market;
var biaoqianval = false;
function bqzhi(){
	biaoqianval  = false;
}
 $(function(){
 
	getscraddress();
	 
 
 });
 
function getmapaddress(){ 
	$(".addressbox").hide();
  $(".mapaddressbox").show();
	$("#scroll_ditu").show();
	var screenheight = ($(window).height())*0.5;
	$(".mapditu").css('height',screenheight);
	getLocation();
}
function getmapshow(lng,lat){ 
	var map = new BMap.Map("map");   
	var point = new BMap.Point(lng,lat);   
	map.centerAndZoom(point, 15);   
	map.enableScrollWheelZoom(); 
	map.enableContinuousZoom(); 
	showmapnearadr(lng,lat);  
	//map.enableKeyboard(); //键盘方向键缩放事件
	map.addEventListener("dragend", function(){   //拖拽事件  
	 var center = map.getCenter();   
	 showmapnearadr(center.lng,center.lat);
	 
	});
}
function getdefaultmapshow(lng,lat){
	var map = new BMap.Map("map");  
	var point = new BMap.Point('<{$lng}>','<{$lat}>');  
//	var point = new BMap.Point(113.597715,34.802461);  
	map.centerAndZoom(point, 15);  
	map.enableScrollWheelZoom();
	map.enableContinuousZoom();
//	showmapnearadr(113.597715,34.802461);
	showmapnearadr('<{$lng}>','<{$lat}>'); 
	//map.enableKeyboard(); //键盘方向键缩放事件
	map.addEventListener("dragend", function(){   //拖拽事件  
	 var center = map.getCenter();     
	 showmapnearadr(center.lng,center.lat);
	 
	});
	
}
function showmapnearadr(lng,lat){ 
	 $.getScript('http://api.map.baidu.com/geocoder/v2/?ak=<{$baidumapkey}>&callback=renderReverse&location='+lat+','+lng+'6&output=json&pois=1'); 
}
function renderReverse(datas){ 
	 
	 if(datas.status == 0){
	 	$("#choiceguidebox ul").html('');
		 /* 
		 {"addr":"河南省郑州市中原区华淮小区11栋",
		 "cp":"NavInfo",
		 "direction":"附近",
		 "distance":"40",
		 "name":"华淮小区11栋",
		 "poiType":"房地产",
		 "point":{"x":113.60700002968,"y":34.736593865518},
		 "tag":"房地产;住宅区","tel":"","uid":"97389a78371b6f76b020a838","zip":""}
		 
		 */
	 if( datas.result.business != '' ){		 
			$('#choiceguidebox ul').append('<li lat="'+datas.result.location.lat+'"  lng="'+datas.result.location.lng+'"  address="'+datas.result.business+'"  ><div class="addresslist" ><p class="choicegudie" style="color:red;">[推荐位置]'+datas.result.business+'</p><p class="choicedetgudie" >'+datas.result.formatted_address+'</p></div></li>');
		}
		if(datas.result.pois.length > 0){
			//	$("#choiceguidebox ul").html('');
				for(i=0;i<datas.result.pois.length;i++){
				
					$('#choiceguidebox ul').append('<li lat="'+datas.result.pois[i].point.y+'"  lng="'+datas.result.pois[i].point.x+'"  address="'+datas.result.pois[i].name+'"  ><div class="addresslist"><p class="choicegudie">'+datas.result.pois[i].name+'</p><p class="choicedetgudie">'+datas.result.pois[i].addr+'</p></div></li>');
					
					
				}
					setTimeout("bqzhi()",200 );
					 myScroll.refresh();
			
			}else{
		//	$("#choiceguidebox ul").html('');
			 $('#choiceguidebox ul').append('<li><div class="addresslist" style="text-align:center;"><p class="choicegudie">获取地址失败</p><p class="choicedetgudie" style="text-align:center;">请在尝试下</p></div></li>');
			
			setTimeout("bqzhi()",200 );
			 myScroll.refresh();
			}
			
			 $("#choiceguidebox ul li").bind('click',function(){
				var lng = $(this).attr('lng');
				var lat = $(this).attr('lat');
				var address = $(this).attr('address');
        $('#scroll_ditu').hide();
				choiceaddress(lng,lat,address);
			})
		
	 }
}
 
function getscraddress(){
  biaoqianval = false;  
	if(biaoqianval == false){
	  
		//	 setTimeout("bqzhi()",500 );  
			 
		
						var searchval  = $("#searchKeywords").val();
						
						if(searchval != ''){ 
					
								biaoqianval  = true;
									  
									var searchvalue = encodeURI(searchval);
									var tempurl = 'http://api.map.baidu.com/geocoder/v2/?address='+searchvalue+'&output=json&ak=<{$baidumapkey}>&callback=showLocation';
                  //alert(tempurl);
									$.getScript(tempurl); 
						  
					
						} 
	}

}
function showLocation(datas){
	$("#choiceguidebox ul").html(''); 
	if(datas.status == 0){
		var lng = datas.result.location.lng;
		var lat = datas.result.location.lat;
		showmapnearadr(lng,lat);
	}
}
function choiceaddress(lng,lat,address){
	$(".mapaddressbox").hide();
	$(".addressbox").show();
	$(".newinp1").attr('lng',lng);
	$(".newinp1").attr('lat',lat);
	$(".newinp1").text(address);
}
function getLocation() { 
  if (navigator.geolocation)
    {  
       navigator.geolocation.getCurrentPosition(showPosition,showError);
    }
   else{
		getdefaultmapshow();
	}
  }

function showPosition(position)
{ 	 
	var lng = position.coords.longitude;
	var lat = position.coords.latitude;       
	getmapshow(lng,lat);
}
 function showError(error)
  { 
  getdefaultmapshow();
   switch(error.code) 
    {
    	
    case error.PERMISSION_DENIED:
      //x.innerHTML="User denied the request for Geolocation."
    //  $('#showareainfo').text("User denied the request for Geolocation.");
      break;
    case error.POSITION_UNAVAILABLE:
     // x.innerHTML="Location information is unavailable."
      //$('#showareainfo').text("Location information is unavailable.");
      break;
    case error.TIMEOUT:
    //  x.innerHTML="The request to get user location timed out."
    //$('#showareainfo').text("The request to get user location timed out.");
      break;
    case error.UNKNOWN_ERROR:
     // x.innerHTML="An unknown error occurred."
     //  $('#showareainfo').text("An unknown error occurred.");
      break;
    }
     
  }
function saveaddress(){ 
		$('#loading').show();
  		var detailadr = $(".newinp2").val();
 		<{if $addAreaType == 1}>
			var bigadr = $(".newinp1").val();
			var tempaddress = $(".newinp1").val();
		<{else}>
			var bigadr = $(".newinp1").text();
			var tempaddress = $(".newinp1").text()+$(".newinp2").val();
		<{/if}>
		
		var lng = $(".newinp1").attr('lng');
		var lat = $(".newinp1").attr('lat');
         var info = {'contactname':$('#contactname').val(),'lng':lng,'lat':lat,'phone':$('#mobile').val(),'check_message':$('#phoneyan').val(),'bigadr':bigadr,'detailadr':detailadr,'add_new':tempaddress,'addressid':$('input[name="add_addressid"]').val()};
	  	var url = '<{ofunc type=url link="/area/saveaddress/random/@random@/datatype/json"}>';
		  var backdata = ajaxback(url,info); 
		  if(backdata.flag == false){ 
		  	 $("#gdcart").show("slow");
			$('#otheraddress').hide("slow");
			   window.location.reload();
			   getadmylist();
		  }else{
		  	$('#loading').hide();
		     Tmsg(backdata.content);
		  }
		  
	}
//获取手机验证码
function clickyanzheng(){
	var tempurl = siteurl + '/index.php?mid=<{$mid}>&ctrl=area&action=areaAddressPhone&random=@random@&phone=@phone@';
	tempurl = tempurl.replace('@random@', 1 + Math.round(Math.random() * 1000)).replace('@phone@', $('#mobile').val());
	$.getScript(tempurl);
}
function areashowsend(phone,time){
	$('input[name="phone"]').val(phone);
	$('#dosendbtn').attr('time',time);
	setTimeout("btntime();",1000);
}
function noshow(msg){
	alert(msg);
}
function  btntime(){

	var nowtime = Number($('#dosendbtn').attr('time'));
	if(nowtime > 0){
		$('#dosendbtn').attr('disabled',true);
		$('#dosendbtn').addClass('signmebg1');
		var c = Number(nowtime)-1;
		$('#dosendbtn').attr('time',c);
		var  mx = 120-(120 - Number(c));
		$('#dosendbtn').attr('value','剩余'+mx+'秒');
		setTimeout("btntime();",1000);
	}else{
		$('#dosendbtn').attr('disabled',false);
		$('#dosendbtn').removeClass('signmebg1');
		$('#dosendbtn').attr('value','重新发送');
	}

}
</script>
<{/block}>